pet/pet_id/diaries/date:
  post:
    security: []
    tags:
      - diary
    summary: 新しい日記を作成する
    description: 新しい日記を作成する
    operationId: createDiary
    parameters:
      - name: pet_id
        in: path
        required: true
        schema:
          type: string
      - name: date
        in: path
        required: true
        schema:
          type: string
          format: date
    requestBody:
      required: true
      content:
        application/json:
          schema:
            properties:
              picture_name:
                type: string
                description: 日付に紐づく写真のファイル名
              weather:
                type: string
                enum: ['晴れ', '曇り', '雨', '雪']
                description: 天気
              temperature:
                type: number
                format: float
                description: 気温
            required:
              - picture_name
              - weather
              - temperature
    responses:
      '201':
        description: 日記の作成に成功
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Diary'
            examples:
              example1:
                $ref: '#/components/examples/ExampleDiary1'
              example2:
                $ref: '#/components/examples/ExampleDiary2'
      '400':
        description: 入力が無効
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
            example:
              message: 'task must be an array'
      '500':
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
            example:
              message: 'Internal server error'

  get:
    security: []
    tags:
      - diary
    summary: 特定の日付の日記を取得する
    description: 指定された'pet_id'と'date'に紐づく日記を取得する
    operationId: getDiary
    parameters:
      - name: pet_id
        in: path
        required: true
        schema:
          type: string
      - name: date
        in: path
        required: true
        schema:
          type: string
          format: date
    responses:
      '200':
        description: 日記の取得に成功
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Diary'
            examples:
              example1:
                $ref: '#/components/examples/ExampleDiary1'
              example2:
                $ref: '#/components/examples/ExampleDiary2'
      '404':
        description: 日記が見つかりません
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
            example:
              message: '日記が見つかりませんでした'
      '500':
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
            example:
              message: 'Internal server error'

  put:
    security: []
    tags:
      - diary
    summary: 日記を更新する
    description: 指定された'pet_id'と'date'に紐づく日記を更新する
    operationId: updateDiary
    parameters:
      - name: pet_id
        in: path
        required: true
        schema:
          type: string
      - name: date
        in: path
        required: true
        schema:
          type: string
          format: date
    requestBody:
      required: false
      content:
        application/json:
          schema:
            type: object
            properties:
              reacted:
                type: boolean
                description: 更新されたリアクション
              comment:
                type: string
                description: ユーザのコメント
              task:
                type: array
                items:
                  $ref: '#/components/schemas/DiaryTask'
                description: 更新されたタスクのリスト

    responses:
      '200':
        description: 日記の更新に成功
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Diary'
            examples:
              example1:
                $ref: '#/components/examples/ExampleDiary1'
              example2:
                $ref: '#/components/examples/ExampleDiary2'
      '404':
        description: 日記が見つかりません
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
            example:
              message: '日記が見つかりませんでした'
      '500':
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'
            example:
              message: 'Internal server error'

components:
  schemas:
    DiaryTask:
      type: object
      properties:
        title:
          type: string
          description: タスクのタイトル
        description:
          type: string
          description: タスクの概要
        scheduled_time:
          type: string
          format: time
          description: タスクの予定時刻
        completed:
          type: boolean
          description: タスクの完了状態
        repeat:
          type: boolean
          description: タスクの繰り返し設定
        sub_task:
          type: array
          items:
            $ref: '#/components/schemas/DiarySubTask'
          description: サブタスクのリスト
      required:
        - title
        - scheduled_time
        - completed
        - repeat

    DiarySubTask:
      type: object
      properties:
        title:
          type: string
          description: サブタスクのタイトル
        description:
          type: string
          description: サブタスクの説明
        scheduled_time:
          type: string
          format: time
          description: サブタスクの予定時刻
        completed:
          type: boolean
          description: サブタスクの完了状態

      required:
        - title
        - description
        - completed
        - scheduled_time

    Diary:
      type: object
      properties:
        pet_id:
          type: string
          description: ペットのID
        date:
          type: string
          format: date
          description: 日付
        picture_name:
          type: string
          description: 当日撮影した写真のファイル名
        reacted:
          type: boolean
          description: 親のリアクション
        advice:
          type: string
          description: AIのアドバイス
        comment:
          type: string
          description: ユーザのコメント
        weather:
          type: string
          description: 天気
        temperature:
          type: string
          description: 気温
        task:
          type: array
          items:
            $ref: '#/components/schemas/DiaryTask'
          description: タスクのリスト
        created_at:
          type: string
          format: date-time
          description: 作られた日時
        updated_at:
          type: string
          format: date-time
          description: 更新された日時

    Error:
      type: object
      properties:
        message:
          type: string
          description: エラーメッセージ

  examples:
    ExampleDiary1:
      value:
        pet_id: 'cfea3ecc-7250-4ccf-a41d-ea7f896a9cc5'
        date: '2025-06-14'
        picture_name: 'https://picsum.photos/id/237/720/720'
        reacted: false
        advice: '少し寒かったね。\nあたたかくしてくれて\nありがとう！'
        comment: '楽しかったね！'
        weather: '晴れ'
        temperature: '20.5'
        task: [
          {
            title: '朝の散歩',
            description: '2km走る',
            scheduled_time: '08:00',
            completed: true,
            repeat: true,
            sub_task: [
              {
                title: 'リードの装着',
                description: '首輪とリードを付ける',
                completed: true,
                scheduled_time: '07:55'
              },
              {
                title: '公園まで散歩',
                description: '近所の公園まで散歩',
                completed: false,
                scheduled_time: '08:00'
              }
            ]
          },
          {
            title: 'おやつ',
            description: 'お気に入りのおやつをあげる',
            scheduled_time: '10:00',
            completed: false,
            repeat: false,
            sub_task: []
          },
          {
            title: 'ブラッシング',
            description: '毛並みを整える',
            scheduled_time: '15:00',
            completed: false,
            repeat: false,
            sub_task: []
          },
          {
            title: 'シャンプー',
            description: '体を清潔にする',
            scheduled_time: '18:00',
            completed: false,
            repeat: true,
            sub_task: []
          }
        ]
        created_at: '2025-06-15T10:00:00Z'
        updated_at: '2025-06-15T10:00:00Z'

    ExampleDiary2:
      value:  
        pet_id: 'cfea3ecc-7250-4ccf-a41d-ea7f896a9cc5'
        date: '2025-06-16'
        picture_name: 'https://picsum.photos/id/237/720/720'
        reacted: true
        advice: '今日は暑かったね。\n水分補給をしっかりして\n休憩も取れたね！'
        comment: '元気いっぱいだったよ！'
        weather: '晴れ'
        temperature: '28.5'
        task: [
          {
            title: '朝の散歩',
            description: '1.5km走る',
            scheduled_time: '07:30',
            completed: true,
            repeat: true,
            sub_task: [
              {
                title: 'リードの装着',
                description: '首輪とリードを付ける',
                completed: true,
                scheduled_time: '07:25'
              },
              {
                title: '公園まで散歩',
                description: '近所の公園まで散歩',
                completed: true,
                scheduled_time: '07:30'
              }
            ]
          },
          {
            title: 'おやつ',
            description: '夏用のおやつをあげる',
            scheduled_time: '11:00',
            completed: true,
            repeat: false,
            sub_task: []
          },
          {
            title: 'ブラッシング',
            description: '毛並みを整える',
            scheduled_time: '16:00',
            completed: true,
            repeat: false,
            sub_task: []
          },
          {
            title: 'シャンプー',
            description: '体を清潔にする',
            scheduled_time: '19:00',
            completed: true,
            repeat: true,
            sub_task: []
          }
        ]
        created_at: '2025-06-16T10:00:00Z'
        updated_at: '2025-06-16T10:00:00Z'

    ExampleDiary3:
      value:
        pet_id: 'cfea3ecc-7250-4ccf-a41d-ea7f896a9cc5'
        date: '2024-03-20'
        picture_name: 'https://picsum.photos/id/237/720/720'
        reacted: false
        advice: '今日は暖かくしよう！'
        comment: '楽しかったね！'
        weather: '晴れ'
        temperature: "20.5"
        task: [
          {
            title: '朝の散歩',
            description: '2km走る',
            scheduled_time: '08:00',
            completed: true,
            repeat: true,
            sub_task: [
              {
                title: 'リードの装着',
                description: '首輪とリードを付ける',
                completed: true,
                scheduled_time: '07:55'
              },
              {
                title: '公園まで散歩',
                description: '近所の公園まで散歩',
                completed: false,
                scheduled_time: '08:00'
              }
            ]
          }
        ]
        created_at: '2025-06-15T10:00:00Z'
        updated_at: '2025-06-15T10:00:00Z'
